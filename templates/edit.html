{% extends "layout.html" %}

{% block title %}Add note{% endblock %}
{% block nav %}<li id="user_id"><textarea name="user_id" id="ser_id" cols="30" rows="2" readonly>Your id is: {{ user_id }}</textarea></li>{% endblock %}
{% block body %}
<style>
    #note {
        display: block;
        overflow: hidden;
        resize: none;
    }
    #title {
        display: block;
        overflow: hidden;
        resize: none;
    }
</style>
<div id="yo">
    <form method="POST" id="no">
            <textarea id="title" name="title" rows="1" cols="1" onkeyup="rmSpace(event)" placeholder="Title">{{title}}</textarea>
            <textarea id="note" name="note" cols="50" placeholder="Take a note">{{note}}</textarea>
            <textarea readonly class="disn" name="disn">{{ID}}</textarea>
            <li><input type="text" id="share" name="share" autocomplete="off" placeholder="Enter the ids of the people you want to share this note with" value="{{ lis }}"></li>
            <p id="chars">you have typed 0 characters.</p>
            <input type="submit" value="Edit note" id="add_note">
    </form>
</div>
    <script type="text/javascript">
    textarea = document.querySelector("#note");
    textarea.addEventListener("input", fun, false);
        function fun(){
            this.style.height = "auto";
            this.style.height = this.scrollHeight + "px";
            he = this.scrollHeight;
            he = he + 85;
            document.querySelector("#add_note").style.position = "absolute";
            document.querySelector("#add_note").style.top = (he + 109) + "px";
            document.querySelector("#add_note").style.right = 0 + "px";
            //moving ids
            document.querySelector("#share").style.position = "absolute";
            document.querySelector("#share").style.top = (he + 39) + "px";

            document.querySelector("#no").style.height = "auto";
            document.querySelector("#no").style.height = (this.scrollHeight + document.querySelector("#title").scrollHeight + 35) + "px";
            //str length
            str = document.querySelector("#note").value.length;
            document.querySelector("#chars").innerHTML = "you have typed " + str + " characters.";
            //moving it
            document.querySelector("#chars").style.position = "absolute";
            document.querySelector("#chars").style.top = (he - 2) + "px";
        }
        document.querySelector("#title").addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
    	    $("#note").focus();
            }
        });
        function rmSpace(){
        var b = document.querySelector("#title").value;
        var res = b.replace(/\n/g, "");
        document.querySelector("#title").value = res;
        }
        window.onload = function(){
            document.querySelector("#note").style.height = "auto";
            document.querySelector("#note").style.height = document.querySelector("#note").scrollHeight + "px";
            he = document.querySelector("#note").scrollHeight;
            he = he + 85;
            document.querySelector("#add_note").style.position = "absolute";
            document.querySelector("#add_note").style.top = (he + 109) + "px";
            document.querySelector("#add_note").style.right = 0 + "px";
            //moving ids
            document.querySelector("#share").style.position = "absolute";
            document.querySelector("#share").style.top = (he + 39) + "px";

            document.querySelector("#no").style.height = "auto";
            document.querySelector("#no").style.height = (document.querySelector("#note").scrollHeight + document.querySelector("#title").scrollHeight + 35) + "px";
            //str length
            str = document.querySelector("#note").value.length;
            document.querySelector("#chars").innerHTML = "you have typed " + str + " characters.";
            //moving it
            document.querySelector("#chars").style.position = "absolute";
            document.querySelector("#chars").style.top = (he - 2) + "px";
            //ids
            ids = document.querySelector("#share").value;
            ids = ids.replace("[", "");
            res = ids.replace("]", "");
            res = res.replace(/'/g, "");
            console.log(ids);
            console.log(res);
            document.querySelector("#share").value = res;
        };

</script>
{% endblock %}